<analysis>**original_problem_statement:**
Initialement, le projet visait à construire un Lecteur Média Unifié. L'objectif a ensuite évolué pour stabiliser l'application, réparer la programmation des campagnes (emails et WhatsApp), et rendre le scheduler de campagnes autonome.

L'objectif actuel, et la priorité absolue (P0), est de résoudre un bug critique où le **Chat IA est aveugle** aux données dynamiques du site (offres, produits, articles). L'utilisateur a fourni des preuves vidéo montrant que l'IA ne reconnaît pas les produits existants (ex: café congolais) lors d'une conversation sur l'interface, bien que le produit soit présent en base de données.

Un point de friction constant est la conviction de l'utilisateur que le projet utilise une stack Next.js/Prisma, alors que la stack réelle est **React (JavaScript) / FastAPI (Python) / MongoDB**.

**User's preferred language**: Français

**what currently exists?**
-   **Stack Technique**: Frontend React (Create React App), Backend FastAPI (Python), et base de données MongoDB.
-   **Backend ()**: Un fichier principal contenant toute la logique métier, y compris les API CRUD, l'envoi d'emails (Resend), l'intégration WhatsApp (Twilio), et la logique du Chat IA ().
-   **Scheduler Autonome**: La logique de programmation des campagnes est désormais intégrée dans  et s'exécute en tant que thread d'arrière-plan (daemon) au démarrage du serveur. Il gère les erreurs de quota email et possède un endpoint de santé ().
-   **Frontend ()**: Inclut un  monolithique (qui affiche l'état du scheduler) et un  pour l'interface du Chat IA.

**Last working item**:
-   **Last item agent was working:** L'agent a diagnostiqué pourquoi le Chat IA ne reconnaissait pas les produits (café congolais) dans les vidéos de l'utilisateur, malgré des tests backend réussis via . Le problème semble être une désynchronisation entre les tests de l'agent (backend uniquement) et l'environnement réel de l'utilisateur (frontend). L'agent a ajouté des logs de diagnostic () dans la route  de , redémarré le serveur, et a de nouveau validé via  que la logique de récupération des données depuis MongoDB fonctionnait correctement.
-   **Status:** USER VERIFICATION PENDING
-   **Agent Testing Done:** Y (Uniquement sur le backend avec . Le test frontend n'a pas été fait.)
-   **Which testing method agent to use?** Frontend testing agent. La validation doit se faire en interagissant avec le  sur l'interface pour reproduire le scénario de l'utilisateur et confirmer que l'IA répond correctement. Un simple test  est insuffisant.
-   **User Testing Done:** Y (Échec, confirmé par plusieurs enregistrements vidéo fournis par l'utilisateur).

**All Pending/In progress Issue list**:
*   **Issue 1: (P0 - Bloquant) Le Chat IA est aveugle aux données du site dans l'interface utilisateur.**
    *   **Description:** L'IA ne reconnaît pas les produits, articles ou cours lors des conversations via le widget de chat, même si les données existent dans la base de données MongoDB. L'utilisateur a fourni des vidéos le prouvant. Bien que le code backend semble correct et fonctionne lors des tests , le résultat n'est pas visible sur le frontend.
    *   **Attempted fixes:** L'agent a modifié la route  dans  pour récupérer les offres, produits (), cours et articles de MongoDB et les injecter dans le prompt système de l'IA. Des logs de diagnostic ont été ajoutés pour prouver que les données sont bien lues côté backend.
    *   **Next debug checklist:**
        1.  Cesser de se fier aux tests . Le bug est dans l'interaction E2E (End-to-End).
        2.  Utiliser un outil de test frontend pour interagir avec le  comme un utilisateur réel.
        3.  Poser la question Vendez-vous du café ? dans le widget et vérifier la réponse de l'IA.
        4.  Inspecter la console du navigateur (onglet Réseau) lors du test pour voir la requête exacte envoyée à  et la réponse reçue, afin de détecter d'éventuels problèmes de cache ou de payload.
    *   **Why fix this issue and what will be achieved with the fix?** C'est la fonctionnalité critique demandée par l'utilisateur. La réparer rendra le Chat IA utile et dynamique.
    *   **Status:** IN PROGRESS
    *   **Is recurring issue?** Y
    *   **Should Test frontend/backend/both after fix?** Frontend
    *   **Blocked on other issue:** Non

**In progress Task List**:
*   Aucune. Le focus est sur l'Issue 1.

**Upcoming and Future Tasks**
*   **Upcoming Tasks:**
    *   **P1: Gérer les articles dans le Dashboard**: Créer une interface dans  pour permettre à l'utilisateur de créer, modifier et supprimer des articles (la collection  a été créée manuellement par l'agent).
    *   **P1: Finaliser la configuration WhatsApp**: L'envoi de messages WhatsApp est bloqué car le numéro Twilio de l'utilisateur () n'est pas configuré comme un sender WhatsApp. L'agent doit guider l'utilisateur pour finaliser cette configuration dans sa console Twilio.
    *   **P1: Valider l'export CSV**: La fonctionnalité d'export des contacts CRM existe mais n'a jamais été testée et validée par l'utilisateur.
*   **Future Tasks:**
    *   **P2: Refactoring de **: Décomposer ce composant monolithique de plus de 6000 lignes.
    *   **P2: Mettre à jour le manuel utilisateur**.
    *   **P2: Ajouter un tableau de bord analytique**.

**Completed work in this session**
-   **Chat IA - Contexte Dynamique (Backend)**: La route  dans  a été modifiée pour injecter dynamiquement les offres, produits, cours et articles depuis MongoDB dans le prompt de l'IA.
-   **Chat IA - CRM Automatique**: Une logique d'enregistrement/mise à jour automatique des contacts a été ajoutée à la route , avec une protection anti-doublon.
-   **Scheduler - Mode Daemon**: Le scheduler est désormais un thread qui démarre automatiquement avec le serveur FastAPI, le rendant autonome.
-   **Scheduler - Indicateur de Santé**: Un endpoint  a été créé et un badge de statut visuel a été ajouté au .
-   **Scheduler - Reprise sur Quota**: La logique a été améliorée pour que les campagnes échouant à cause du quota Resend passent en statut  et soient retentées automatiquement, au lieu d'échouer définitivement.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Configuration du canal WhatsApp sur Twilio.**
    *   **Debug checklist:** L'agent doit rappeler à l'utilisateur que son numéro  doit être activé comme sender WhatsApp dans sa console Twilio pour que l'envoi de messages fonctionne.
    *   **Why to solve this issue and what will be achieved with this?** Débloquera toutes les fonctionnalités liées à WhatsApp (campagnes et notifications).
    *   **Should Test frontend/backend/both after fix:** Backend
    *   **Is recurring issue?** Y

**Known issue recurrence from previous fork**
-   **Scheduler failing:** Le scheduler a été une source récurrente de problèmes. Il a été entièrement revu pour fonctionner comme un daemon intégré, ce qui devrait le stabiliser.
    -   **Recurrence count:** 3+
    -   **Status:** RESOLVED (mais reste une zone sensible).

**Code Architecture**


**Key Technical Concepts**
-   **Stack**: React.js (JavaScript), FastAPI (Python), MongoDB.
-   **Tâches de fond**: Scheduler implémenté avec  au démarrage de FastAPI.
-   **Intégration IA**: Augmentation dynamique du prompt système avec des données de MongoDB avant l'appel à une API LLM (probablement OpenAI).

**key DB schema**
-   ****: 
-   ****: 
-   ****: 
-   ****: 
-   ****: 

**All files of reference**
-   : Fichier central pour le bug actuel. Contient la logique de la route .
-   : Composant frontend où le bug se manifeste.

**Critical Info for New Agent**
-   **Langue :** Répondez **exclusivement en Français**.
-   **QUIPROQUO SUR LA STACK**: L'utilisateur est **persuadé** que le projet est en Next.js/Prisma. C'est **FAUX**. La stack est **React/FastAPI/MongoDB**. Ne vous laissez pas dérouter. Concentrez-vous sur la résolution des problèmes dans la stack existante.
-   **PRIORITÉ P0**: Votre unique mission est de faire en sorte que le Chat IA reconnaisse les produits et articles dans l'**interface utilisateur réelle**. Les tests  sont insuffisants. Le succès sera validé par un test E2E sur le frontend.
-   **WHATSAPP BLOQUÉ**: L'envoi de messages WhatsApp est actuellement impossible à cause d'un problème de configuration Twilio (). C'est un problème secondaire mais important à garder en tête.

**Last 10 User Messages and any pending HUMAN messages**
10. **(Vidéo)** L'utilisateur prouve que l'IA ne voit pas le café congolais.
9.  **(Requête)** L'utilisateur demande des modifications sur des fichiers Next.js/Prisma ().
8.  **(Image)** L'utilisateur montre une capture d'écran de l'échec de l'IA.
7.  **(Requête)** L'utilisateur demande à l'agent de corriger la récupération des données dans .
6.  **(Bug)** L'utilisateur signale que l'IA est aveugle.
5.  **(Requête)** L'utilisateur demande que l'IA ait une vision totale des données du site.
4.  **(Requête)** L'utilisateur insiste à nouveau sur la stack Next.js/Prisma.
3.  **(Bug)** L'utilisateur signale que l'IA ne voit pas les articles nouvellement créés.
2.  **(Requête)** L'utilisateur demande à synchroniser l'IA avec la base de données.
1.  **(Requête)** L'utilisateur demande la finalisation du flux email et l'ajout d'un indicateur de santé pour le scheduler.

**Project Health Check:**
-   **Broken:** La fonctionnalité de Chat IA est cassée du point de vue de l'utilisateur, ce qui est la priorité actuelle. La fonctionnalité WhatsApp est bloquée par une configuration externe.

**3rd Party Integrations**
-   **Resend**: Pour l'envoi d'emails.
-   **Twilio**: Pour l'envoi de messages WhatsApp (actuellement non fonctionnel).
-   **OpenAI (inféré)**: Pour le service de Chat IA.

**Testing status**
-   **Testing agent used after significant changes:** NO
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** []
-   **Known regressions:** La fonctionnalité de Chat IA a régressé ou n'a jamais fonctionné correctement en production du point de vue de l'utilisateur.

**What agent forgot to execute**
-   L'agent précédent n'a pas effectué de test End-to-End sur l'interface utilisateur pour valider la correction du Chat IA, se contentant de tests backend via . Cela a créé une divergence entre le succès perçu par l'agent et l'échec constaté par l'utilisateur.
-   Le suivi du problème de configuration de Twilio pour WhatsApp n'a pas été mené à son terme.</analysis>
